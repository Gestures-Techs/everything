<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Android XML & XPath Validator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Simple scrollbar styling for a better look */
        textarea::-webkit-scrollbar,
        #result-output::-webkit-scrollbar {
            width: 8px;
        }
        textarea::-webkit-scrollbar-track,
        #result-output::-webkit-scrollbar-track {
            background: #2d3748;
        }
        textarea::-webkit-scrollbar-thumb,
        #result-output::-webkit-scrollbar-thumb {
            background-color: #4a5568;
            border-radius: 20px;
            border: 2px solid #2d3748;
        }
        pre {
            white-space: pre-wrap;       /* Since CSS 2.1 */
            white-space: -moz-pre-wrap;  /* Mozilla, since 1999 */
            white-space: -pre-wrap;      /* Opera 4-6 */
            white-space: -o-pre-wrap;    /* Opera 7 */
            word-wrap: break-word;       /* Internet Explorer 5.5+ */
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-200 min-h-screen flex flex-col items-center p-4 sm:p-6 lg:p-8">

    <div class="w-full max-w-7xl">
        <!-- Header -->
        <header class="text-center mb-8">
            <h1 class="text-3xl sm:text-4xl font-bold text-white">Android XML & XPath Validator</h1>
            <p class="text-gray-400 mt-2">A tool to test XPath expressions against Android's XML layout structure.</p>
        </header>

        <!-- Main Content Area -->
        <main class="flex flex-col gap-6">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <!-- XML Input Area -->
                <div class="flex flex-col">
                    <div class="flex justify-between items-center mb-2">
                        <label for="xml-input" class="font-semibold text-lg">Android XML Content</label>
                        <div class="flex items-center gap-2">
                             <label for="file-upload" class="bg-gray-700 hover:bg-gray-600 text-white text-sm font-bold py-2 px-3 rounded-lg cursor-pointer transition-colors duration-200">
                                Upload File
                            </label>
                            <input id="file-upload" type="file" class="hidden" accept=".xml,text/xml">
                            <button id="clear-btn" class="bg-red-600 hover:bg-red-700 text-white text-sm font-bold py-2 px-3 rounded-lg transition-colors duration-200">Clear</button>
                        </div>
                    </div>
                    <textarea id="xml-input"
                        class="w-full h-96 p-4 bg-gray-800 border border-gray-700 rounded-lg shadow-inner focus:outline-none focus:ring-2 focus:ring-blue-500 text-gray-300 font-mono text-sm resize-y"
                        placeholder="Paste your Android XML here or upload a file..."
                        spellcheck="false"></textarea>
                </div>

                <!-- XPath and Action Area -->
                <div class="flex flex-col gap-6">
                    <div>
                        <label for="xpath-input" class="mb-2 font-semibold text-lg">XPath Expression</label>
                        <textarea id="xpath-input"
                            class="w-full h-24 p-4 bg-gray-800 border border-gray-700 rounded-lg shadow-inner focus:outline-none focus:ring-2 focus:ring-blue-500 text-gray-300 font-mono text-sm resize-y"
                            placeholder="//android.widget.TextView"
                            spellcheck="false"></textarea>
                    </div>
                    <button id="validate-btn"
                        class="w-full bg-blue-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-900 focus:ring-blue-500 transition-colors duration-200">
                        Validate
                    </button>
                </div>
            </div>

            <!-- Results Area -->
            <div class="mt-4">
                <h2 class="text-xl font-semibold mb-2">Results</h2>
                <div id="result-output" class="w-full min-h-[10rem] h-96 p-4 bg-gray-800 border border-gray-700 rounded-lg shadow-inner text-gray-300 font-mono text-sm whitespace-pre-wrap overflow-auto">
                    Validation results will appear here...
                </div>
            </div>
        </main>
    </div>

    <script>
        const xmlInput = document.getElementById('xml-input');
        const xpathInput = document.getElementById('xpath-input');
        const validateBtn = document.getElementById('validate-btn');
        const resultOutput = document.getElementById('result-output');
        const fileUpload = document.getElementById('file-upload');
        const clearBtn = document.getElementById('clear-btn');


        // Pre-fill with example Android XML data
        xmlInput.value = `<android.widget.FrameLayout xmlns:android="http://schemas.android.com/apk/res/android"
    android:layout_width="match_parent"
    android:layout_height="match_parent">

    <android.view.View
        android:id="@android:id/some_id"
        android:layout_width="50dp"
        android:layout_height="50dp"/>

    <android.widget.LinearLayout
        android:orientation="vertical"
        android:layout_height="wrap_content"
        android:layout_width="match_parent">

        <android.widget.TextView
            android:text="My apps &amp; games"
            android:content-description="Tab 1 of 2"
            android:layout_width="wrap_content"
            android:layout_height="wrap_content"/>

        <android.widget.FrameLayout
            android:id="@android:id/content"
            android:clickable="true"
            android:layout_width="match_parent"
            android:layout_height="200dp"/>

    </android.widget.LinearLayout>
</android.widget.FrameLayout>`;

        xpathInput.value = `//android.widget.TextView[@android:text='My apps & games']`;

        // Handle File Upload
        fileUpload.addEventListener('change', (event) => {
            const file = event.target.files[0];
            if (!file) {
                return;
            }

            const reader = new FileReader();
            reader.onload = (e) => {
                const fileContent = e.target.result;
                xmlInput.value = fileContent;
                // Automatically trigger validation after loading the file
                validateBtn.click();
            };
            reader.onerror = () => {
                resultOutput.innerHTML = `<span class="text-red-400">Error reading file: ${reader.error}</span>`;
            };
            reader.readAsText(file);

            // Reset the file input so the user can upload the same file again if they modify it
            event.target.value = null;
        });

        // Handle Clear Button
        clearBtn.addEventListener('click', () => {
            xmlInput.value = '';
            xpathInput.value = '';
            resultOutput.innerHTML = 'Validation results will appear here...';
        });

        // Main validation logic
        validateBtn.addEventListener('click', () => {
            const xmlString = xmlInput.value.trim();
            const xpathString = xpathInput.value.trim();
            resultOutput.innerHTML = ''; // Clear previous results

            if (!xmlString) {
                resultOutput.innerHTML = `<span class="text-yellow-400">XML content area is empty.</span>`;
                return;
            }

            // 1. Validate XML structure
            const parser = new DOMParser();
            const xmlDoc = parser.parseFromString(xmlString, 'application/xml');
            const errorNode = xmlDoc.querySelector('parsererror');

            if (errorNode) {
                resultOutput.innerHTML = `<div class="text-red-400">
    <h3 class="font-semibold mb-2">XML Parsing Error</h3>
    <pre>${errorNode.innerText.replace(/</g, '&lt;').replace(/>/g, '&gt;')}</pre>
</div>`;
                return;
            }

            resultOutput.innerHTML = `<div class="text-green-400 mb-4">
    <h3 class="font-semibold">XML is well-formed.</h3>
</div>`;

            // 2. Evaluate XPath if provided
            if (!xpathString) {
                 resultOutput.innerHTML += `<span class="text-yellow-400">No XPath expression provided to evaluate.</span>`;
                 return;
            }

            // 3. Namespace resolver for 'android:' prefix
            function nsResolver(prefix) {
                const ns = { 'android': 'http://schemas.android.com/apk/res/android' };
                return ns[prefix] || null;
            }

            try {
                // 4. Evaluate the XPath with the namespace resolver
                const iterator = xmlDoc.evaluate(xpathString, xmlDoc, nsResolver, XPathResult.ORDERED_NODE_ITERATOR_TYPE, null);
                
                let resultHTML = '<h3 class="font-semibold text-gray-200 mb-2">XPath Evaluation Result</h3>';
                let hasResults = false;
                let node = iterator.iterateNext();
                let count = 0;
                let nodesText = '';
                const serializer = new XMLSerializer();

                while (node) {
                    hasResults = true;
                    count++;
                    const nodeString = serializer.serializeToString(node);
                    // Basic indentation for readability
                    const indentedNodeString = nodeString.replace(/></g, '>\n  <');
                    nodesText += `<!-- Node ${count} -->\n${indentedNodeString.replace(/</g, '&lt;').replace(/>/g, '&gt;')}\n\n`;
                    node = iterator.iterateNext();
                }

                if(hasResults) {
                    resultHTML += `<div class="text-cyan-400 mb-2">Found ${count} node(s):</div><pre class="bg-gray-900 p-2 rounded text-sm">${nodesText.trim()}</pre>`;
                } else {
                    resultHTML += `<span class="text-gray-400">XPath expression did not match any nodes.</span>`;
                }

                resultOutput.innerHTML += resultHTML;

            } catch (e) {
                resultOutput.innerHTML += `<div class="text-red-400">
    <h3 class="font-semibold mb-2">XPath Error</h3>
    <pre>${e.message.replace(/</g, '&lt;').replace(/>/g, '&gt;')}</pre>
</div>`;
            }
        });

        // Trigger initial validation on load
        validateBtn.click();
    </script>
</body>
</html>

